<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Account Chart Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .toolbar {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .toolbar button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .toolbar button:hover {
            background: #45a049;
        }
        
        #canvas {
            background: white;
            min-height: 600px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            position: relative;
        }
        
        .t-account {
            position: absolute;
            background: white;
            border: 2px solid #333;
            border-radius: 4px;
            min-width: 400px;
            cursor: move;
        }
        
        .t-account.dragging {
            opacity: 0.7;
        }
        
        .t-account-header {
            text-align: center;
            padding: 10px;
            border-bottom: 2px solid #333;
            font-weight: bold;
            background: #f9f9f9;
        }
        
        .t-account-header input {
            width: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            padding: 5px;
        }
        
        .t-account-header input:focus {
            outline: 2px solid #4CAF50;
            background: white;
        }
        
        .t-account-body {
            display: flex;
        }
        
        .t-account-column {
            flex: 1;
            min-width: 200px;
        }
        
        .t-account-column.left {
            border-right: 2px solid #333;
        }
        
        .t-account-row {
            display: flex;
            border-bottom: 1px solid #ddd;
            min-height: 40px;
        }
        
        .t-account-row:last-child {
            border-bottom: none;
        }
        
        .t-account-cell {
            flex: 1;
            padding: 8px;
        }
        
        .t-account-cell input {
            width: 100%;
            border: none;
            background: transparent;
            padding: 4px;
            font-size: 14px;
        }
        
        .t-account-cell input:focus {
            outline: 1px solid #4CAF50;
            background: #f0f8ff;
        }
        
        .t-account-controls {
            padding: 10px;
            background: #f9f9f9;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .t-account-controls button {
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-add {
            background: #4CAF50;
            color: white;
        }
        
        .btn-add:hover {
            background: #45a049;
        }
        
        .btn-remove {
            background: #f44336;
            color: white;
        }
        
        .btn-remove:hover {
            background: #da190b;
        }
        
        .btn-delete {
            background: #ff9800;
            color: white;
        }
        
        .btn-delete:hover {
            background: #e68900;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button onclick="addTAccount()">+ Add T-Account</button>
    </div>
    
    <div id="canvas"></div>
    
    <script>
        let accounts = [];
        let draggedAccount = null;
        let offsetX = 0;
        let offsetY = 0;

        // --- Function to calculate sums ---
        function calculateSums(account) {
            let leftSum = 0;
            let rightSum = 0;
            account.rows.forEach(row => {
                leftSum += parseFloat(row.left) || 0;
                rightSum += parseFloat(row.right) || 0;
            });
            return { leftSum, rightSum };
        }
        
        function addTAccount() {
            const account = {
                id: Date.now(),
                x: 50 + (accounts.length * 30),
                y: 50 + (accounts.length * 30),
                header: 'Account Name',
                rows: [
                    { left: '', right: '' },
                    { left: '', right: '' },
                    { left: '', right: '' }
                ]
            };
            accounts.push(account);
            render();
        }
        
        function addRow(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (account) {
                account.rows.push({ left: '', right: '' });
                render();
            }
        }
        
        function removeRow(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (account && account.rows.length > 1) {
                account.rows.pop();
                render();
            }
        }
        
        function deleteAccount(accountId) {
            accounts = accounts.filter(a => a.id !== accountId);
            render();
        }
        
        function updateHeader(accountId, value) {
            const account = accounts.find(a => a.id === accountId);
            if (account) account.header = value;
        }
        
        function updateCell(accountId, rowIndex, side, value) {
            const account = accounts.find(a => a.id === accountId);
            if (account && account.rows[rowIndex]) account.rows[rowIndex][side] = value;
            render(); // Re-render to update sum
        }
        
        function startDrag(e, accountId) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
            const account = accounts.find(a => a.id === accountId);
            const accountEl = e.currentTarget;
            draggedAccount = account;
            offsetX = e.clientX - account.x;
            offsetY = e.clientY - account.y;
            accountEl.classList.add('dragging');
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }
        
        function drag(e) {
            if (draggedAccount) {
                draggedAccount.x = e.clientX - offsetX;
                draggedAccount.y = e.clientY - offsetY;
                render();
            }
        }
        
        function stopDrag() {
            if (draggedAccount) {
                document.querySelector(`[data-account-id="${draggedAccount.id}"]`).classList.remove('dragging');
                draggedAccount = null;
            }
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }
        
        function render() {
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = '';
            
            accounts.forEach(account => {
                const accountEl = document.createElement('div');
                accountEl.className = 't-account';
                accountEl.setAttribute('data-account-id', account.id);
                accountEl.style.left = account.x + 'px';
                accountEl.style.top = account.y + 'px';
                accountEl.onmousedown = (e) => startDrag(e, account.id);
                
                // Header
                const header = document.createElement('div');
                header.className = 't-account-header';
                header.innerHTML = `<input type="text" value="${account.header}" 
                    onchange="updateHeader(${account.id}, this.value)" 
                    onclick="event.stopPropagation()">`;
                accountEl.appendChild(header);
                
                // Body columns
                const body = document.createElement('div');
                body.className = 't-account-body';
                const leftCol = document.createElement('div');
                leftCol.className = 't-account-column left';
                const rightCol = document.createElement('div');
                rightCol.className = 't-account-column right';
                
                // Add rows
                account.rows.forEach((row, i) => {
                    const leftRow = document.createElement('div');
                    leftRow.className = 't-account-row';
                    leftRow.innerHTML = `<div class="t-account-cell">
                        <input type="text" value="${row.left}" 
                            onchange="updateCell(${account.id}, ${i}, 'left', this.value)"
                            onclick="event.stopPropagation()">
                    </div>`;
                    leftCol.appendChild(leftRow);
                    
                    const rightRow = document.createElement('div');
                    rightRow.className = 't-account-row';
                    rightRow.innerHTML = `<div class="t-account-cell">
                        <input type="text" value="${row.right}" 
                            onchange="updateCell(${account.id}, ${i}, 'right', this.value)"
                            onclick="event.stopPropagation()">
                    </div>`;
                    rightCol.appendChild(rightRow);
                });

                // --- Add Sum Row ---
                const { leftSum, rightSum } = calculateSums(account);

                const leftSumRow = document.createElement('div');
                leftSumRow.className = 't-account-row';
                leftSumRow.innerHTML = `<div class="t-account-cell"><strong>Sum: ${leftSum}</strong></div>`;
                leftCol.appendChild(leftSumRow);

                const rightSumRow = document.createElement('div');
                rightSumRow.className = 't-account-row';
                rightSumRow.innerHTML = `<div class="t-account-cell"><strong>Sum: ${rightSum}</strong></div>`;
                rightCol.appendChild(rightSumRow);
                
                body.appendChild(leftCol);
                body.appendChild(rightCol);
                accountEl.appendChild(body);
                
                // Controls
                const controls = document.createElement('div');
                controls.className = 't-account-controls';
                controls.innerHTML = `
                    <button class="btn-add" onclick="event.stopPropagation(); addRow(${account.id})">+ Add Row</button>
                    <button class="btn-remove" onclick="event.stopPropagation(); removeRow(${account.id})">- Remove Row</button>
                    <button class="btn-delete" onclick="event.stopPropagation(); deleteAccount(${account.id})">Delete Account</button>
                `;
                accountEl.appendChild(controls);
                
                canvas.appendChild(accountEl);
            });
        }
        
        // Initialize with one T-account
        addTAccount();
    </script>
</body>
</html>
